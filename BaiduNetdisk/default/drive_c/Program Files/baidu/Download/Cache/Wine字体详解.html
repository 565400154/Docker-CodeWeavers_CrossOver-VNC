<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wine字体详解</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="wine字体详解">Wine字体详解</h1>



<h2 id="1-字体基础">1. 字体基础</h2>



<h3 id="11-三种字体">1.1  三种字体</h3>



<h4 id="111-点阵字体">1.1.1 点阵字体</h4>



<h5 id="特点">特点：</h5>



<h5 id="位图存储">位图存储</h5>



<h5 id="与设备平台相关">与设备平台相关</h5>



<h5 id="扩展名fon">扩展名.fon</h5>



<h4 id="112-矢量字体">1.1.2 矢量字体</h4>



<h5 id="特点-1">特点：</h5>



<h5 id="存储的是轮廓上的关键点">存储的是轮廓上的关键点</h5>



<h5 id="数学函数描述轮廓外形">数学函数描述轮廓外形</h5>



<h5 id="与平台无关">与平台无关</h5>



<h5 id="扩展名ttfttcotf">扩展名ttf，ttc,otf</h5>



<h5 id="主要有truetypetype1opentype">主要有TrueType，Type1，OpenType</h5>



<h5 id="freetype是一个免费的可移植的字体引擎它提供统一的接口来访问多种字体格式文件包括truetype-opentype-type1-cid-cff-windows-fonfnt-x11-pcf等">FreeType是一个免费的可移植的字体引擎，它提供统一的接口来访问多种字体格式文件，包括TrueType, OpenType, Type1, CID, CFF, Windows FON/FNT, X11 PCF等。</h5>



<h5 id="三种矢量字体比较">三种矢量字体比较</h5>

<table>
<thead>
<tr>
  <th>字体</th>
  <th>构造方法</th>
  <th>历史简介</th>
  <th>优势</th>
</tr>
</thead>
<tbody><tr>
  <td>Type1</td>
  <td>使用三次贝塞尔曲线描述</td>
  <td>全称PostScript Type1，1985年由Adobe公司提出，是高端打印机首选的打印描述语言</td>
  <td>比TrueType字体更加精美，且占用空间少。缺点是渲染比较耗时且非开放字体</td>
</tr>
<tr>
  <td>TrueType</td>
  <td>使用二次贝塞尔曲线描述</td>
  <td>1991年由Apple与Microsoft联合提出</td>
  <td>占用空间多，但是渲染很快</td>
</tr>
<tr>
  <td>OpenType</td>
  <td></td>
  <td>1995年Adobe公司和Microsoft公司联手开发的兼容Type1和TrueType的字体</td>
  <td>兼容上面二者优势，基于Unicode</td>
</tr>
</tbody></table>




<h4 id="113-衬线字serif-fonts和无衬线字san-serif-fonts">1.1.3 衬线字（Serif-fonts）和无衬线字（San-serif-fonts）</h4>

<p><img src="http://img.blog.csdn.net/20161216160810845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="衬线字（Serif-fonts）和无衬线字（San-serif-fonts）" title=""></p>



<h2 id="2-字体属性">2. 字体属性</h2>

<p><a href="https://www.freetype.org/freetype2/docs/glyphs/glyphs-3.html">字体详解https://www.freetype.org/freetype2</a></p>



<h2 id="3-字体加载流程">3. 字体加载流程</h2>



<h4 id="字体加载过程总的来说分为三步">字体加载过程总的来说分为三步：</h4>



<h5 id="1-从系统的目录读取字体文件进行加载或更新到cache注册表">1、 从系统的目录读取字体文件进行加载或更新到Cache注册表</h5>

<h5 id="2-从注册表里加载替代字体">2、 从注册表里加载替代字体</h5>



<h5 id="3-将第一步加载的字体映射到字体注册表这一步主要是保证wine跟windows注册表的一致性">3、 将第一步加载的字体映射到字体注册表，这一步主要是保证wine跟windows注册表的一致性</h5>



<h5 id="下面是详细过程">下面是详细过程</h5>

<h3 id="31-加载字体目录的字体">3.1 加载字体目录的字体</h3>



<h4 id="将以下目录中的所有字体加载或更新到注册表">将以下目录中的所有字体加载或更新到注册表</h4>

<table>
<thead>
<tr>
  <th align="left">路径</th>
  <th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
  <td align="left">C:\Windows\Fonts</td>
  <td align="left">系统字体目录</td>
</tr>
<tr>
  <td align="left">/usr/local/share/wine/fonts/</td>
  <td align="left">linux 目录</td>
</tr>
<tr>
  <td align="left">/usr/share/fonts/</td>
  <td align="left">linux 目录</td>
</tr>
</tbody></table>




<h4 id="将以上目录中的字体加载到以下注册表">将以上目录中的字体加载到以下注册表</h4>

<table>
<thead>
<tr>
  <th>名称</th>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>字体Cache</td>
  <td>HKEY_CURRENT_USER</td>
  <td>Software\Wine\Fonts\Cache</td>
  <td>直接从字体目录加载</td>
</tr>
</tbody></table>


<p><img src="http://img.blog.csdn.net/20161216160835627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="字体Cache详细" title=""></p>



<h3 id="32-加载注册表设置的替代字体">3.2 加载注册表设置的替代字体</h3>



<h4 id="替代字体注册表键值">替代字体注册表键值</h4>

<table>
<thead>
<tr>
  <th>名称</th>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>Replacements</td>
  <td>HKEY_CURRENT_USER</td>
  <td>Software\Wine\Fonts\Replacements</td>
  <td>字体替换</td>
</tr>
<tr>
  <td>FontSubstitutes</td>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows NT\CurrentVersion\FontSubstitutes</td>
  <td>字体替代</td>
</tr>
<tr>
  <td>FontLink</td>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows NT\CurrentVersion\FontLink</td>
  <td>字体链接</td>
</tr>
</tbody></table>




<h4 id="这些信息由用户通过注册表设置它们之间的差异如下">这些信息由用户通过注册表设置，它们之间的差异如下：</h4>

<table>
<thead>
<tr>
  <th>名称</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>Replacements</td>
  <td>字体名称替换，用户设置的进行字体名称的替代</td>
</tr>
<tr>
  <td>FontSubstitutes</td>
  <td>字体替代，需要charset匹配且替代字体名称存在才有效</td>
</tr>
<tr>
  <td>FontLink</td>
  <td>字体链接，字体名称与字体文件直接关联</td>
</tr>
</tbody></table>




<h4 id="使用注意">使用注意：</h4>



<h4 id="321-replacements只是进行名称替代其它属性完全使用替代字体的属性所以一定要确定替代字体是存在且有效的">3.2.1 Replacements只是进行名称替代，其它属性完全使用替代字体的属性。所以一定要确定替代字体是存在且有效的</h4>



<h4 id="322-fontsubstitutes-除了跟replacements一样需要保证替代字体存在且需要charset一致">3.2.2 FontSubstitutes 除了跟Replacements一样需要保证替代字体存在，且需要charset一致</h4>



<h4 id="323-fontlink-是将名称和字体文件进行链接">3.2.3 FontLink 是将名称和字体文件进行链接。</h4>



<h4 id="设置格式-tamota-simsunttfsimsun需要保证simsum-在字体cache里或字体映射里存在还需要simsumttf-是一致的文件名不要写全路径">设置格式： “Tamota” = “simsun.ttf,simsun”,需要保证simsum 在字体Cache里或字体映射里存在，还需要simsum.ttf 是一致的。文件名不要写全路径。</h4>

<p><img src="http://img.blog.csdn.net/20161216162253741?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="Font Link" title=""></p>



<h3 id="33-字体映射">3.3 字体映射</h3>



<h4 id="字体映射注册表">字体映射注册表</h4>

<table>
<thead>
<tr>
  <th>名称</th>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>External Font</td>
  <td>HKEY_CURRENT_USER</td>
  <td>Software\Wine\Fonts\External Fonts</td>
  <td>从Cache字体映射过来</td>
</tr>
<tr>
  <td>Fonts</td>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows (NT)\CurrentVersion\Fonts</td>
  <td>同上</td>
</tr>
</tbody></table>




<h4 id="它们的内容一般都是一致的external-font是wine才有的后者与windows-一样windows上没有字体cache信息">它们的内容一般都是一致的，External Font是Wine才有的，后者与windows 一样，windows上没有字体Cache信息。<img src="http://img.blog.csdn.net/20161216162931824?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="字体" title=""></h4>



<h3 id="字体查找selectfont">字体查找(SelectFont)</h3>



<h4 id="基本过程">基本过程</h4>



<div class="sequence-diagram"><svg height="475.875" version="1.1" width="657.5" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative; left: -0.666687px; top: -0.854492px;"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="10" y="20" width="50" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="30" width="30" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="35" y="37.328125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">User</tspan></text><rect x="10" y="421.21875" width="50" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="20" y="431.21875" width="30" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="35" y="438.546875" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">User</tspan></text><path fill="none" stroke="#000000" d="M35,54.65625L35,421.21875" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="210" y="20" width="50" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="220" y="30" width="30" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="235" y="37.328125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">font</tspan></text><rect x="210" y="421.21875" width="50" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="220" y="431.21875" width="30" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="235" y="438.546875" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">font</tspan></text><path fill="none" stroke="#000000" d="M235,54.65625L235,421.21875" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="357.5" y="20" width="80" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="367.5" y="30" width="60" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="397.5" y="37.328125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">freetype</tspan></text><rect x="357.5" y="421.21875" width="80" height="34.65625" r="0" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="367.5" y="431.21875" width="60" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="397.5" y="438.546875" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">freetype</tspan></text><path fill="none" stroke="#000000" d="M397.5,54.65625L397.5,421.21875" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="45" y="72.328125" width="180" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="135" y="79.65625" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">SelectObject(CDC*,HFONT)</tspan></text><path fill="none" stroke="#000000" d="M35,89.3125C35,89.3125,199.08085823059082,89.3125,230.0062543619424,89.3125" stroke-width="2" marker-end="url(#raphael-marker-endblock55)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="245" y="106.984375" width="142.5" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="316.25" y="114.3125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">freetype_SelectFont</tspan></text><path fill="none" stroke="#000000" d="M235,123.96875C235,123.96875,365.1722437143326,123.96875,392.50333004107233,123.96875" stroke-width="2" marker-end="url(#raphael-marker-endblock55)" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="143.96875" width="97.5" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="471.25" y="151.296875" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find_in_cache</tspan></text><path fill="none" stroke="#000000" d="M397.5,138.96875L417.5,138.96875" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,138.96875L417.5,168.625" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,168.625C417.5,168.625,408.4191131591797,168.625,402.4952533841133,168.625" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="178.625" width="135" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="490" y="185.953125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find by familyname</tspan></text><path fill="none" stroke="#000000" d="M397.5,173.625L417.5,173.625" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,173.625L417.5,203.28125" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,203.28125C417.5,203.28125,408.4191131591797,203.28125,402.4952533841133,203.28125" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="213.28125" width="120" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="482.5" y="220.609375" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find by facename</tspan></text><path fill="none" stroke="#000000" d="M397.5,208.28125L417.5,208.28125" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,208.28125L417.5,237.9375" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,237.9375C417.5,237.9375,408.4191131591797,237.9375,402.4952533841133,237.9375" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="247.9375" width="150" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="497.5" y="255.265625" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find in replacements</tspan></text><path fill="none" stroke="#000000" d="M397.5,242.9375L417.5,242.9375" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,242.9375L417.5,272.59375" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,272.59375C417.5,272.59375,408.4191131591797,272.59375,402.4952533841133,272.59375" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="282.59375" width="135" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="490" y="289.921875" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find in substitute</tspan></text><path fill="none" stroke="#000000" d="M397.5,277.59375L417.5,277.59375" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,277.59375L417.5,307.25" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,307.25C417.5,307.25,408.4191131591797,307.25,402.4952533841133,307.25" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="422.5" y="317.25" width="135" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="490" y="324.578125" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">find in font links</tspan></text><path fill="none" stroke="#000000" d="M397.5,312.25L417.5,312.25" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,312.25L417.5,341.90625" stroke-width="2" stroke-dasharray="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="#000000" d="M417.5,341.90625C417.5,341.90625,408.4191131591797,341.90625,402.4952533841133,341.90625" stroke-width="2" stroke-dasharray="0" marker-end="url(#raphael-marker-endblock55)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="271.25" y="349.578125" width="90.5" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="316.25" y="356.90625" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">return HFONT</tspan></text><path fill="none" stroke="#000000" d="M397.5,366.5625C397.5,366.5625,267.3277562856674,366.5625,239.99666995892767,366.5625" stroke-width="2" marker-end="url(#raphael-marker-endblock55)" stroke-dasharray="6,2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="90" y="384.234375" width="90.5" height="14.65625" r="0" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="135" y="391.5625" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: normal; font-family: &quot;Andale Mono&quot;, monospace;" font-size="16px" font-family="Andale Mono, monospace"><tspan dy="5.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">return HFONT</tspan></text><path fill="none" stroke="#000000" d="M235,401.21875C235,401.21875,70.91914176940918,401.21875,39.99374563805759,401.21875" stroke-width="2" marker-end="url(#raphael-marker-endblock55)" stroke-dasharray="6,2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div>

<p>freetype_SelectFont 流程</p>



<h3 id="4-中文字体问题解决办法">4. 中文字体问题解决办法</h3>



<h4 id="第一步确定乱码的字体名称如果能确定就开始下面的检查过程">第一步、确定乱码的字体名称,如果能确定就开始下面的检查过程。</h4>



<h5 id="如果不能确定字体名称最简单的办法是保证至少存在一种有效的中文字体且尽量让字体名称排序比较靠前比如使用aaa作字体名来替代原来的字体名">如果不能确定字体名称，最简单的办法是保证至少存在一种有效的中文字体，且尽量让字体名称排序比较靠前。比如使用AAA作字体名来替代原来的字体名。</h5>

<h4 id="第二步检查字体映射注册表下面两个当中任意一个即可看是否存在这种字体需要确保字体文件路径正确">第二步、检查字体映射注册表，下面两个当中任意一个即可，看是否存在这种字体，需要确保字体文件路径正确</h4>

<table>
<thead>
<tr>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>HKEY_CURRENT_USER</td>
  <td>Software\Wine\Fonts\External Fonts</td>
  <td>从Cache字体映射过来</td>
</tr>
<tr>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows (NT)\CurrentVersion\Fonts</td>
  <td>同上</td>
</tr>
</tbody></table>


<p><img src="http://img.blog.csdn.net/20161219094503173?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p>

<h3 id="第三步-检查replacements注册表是否存在确保替换字体在第二步当中的注册表里存在如果它们本身也是由其它字体替代的则保证替代字体是存在的">第三步、 检查Replacements注册表是否存在，确保替换字体在第二步当中的注册表里存在。如果它们本身也是由其它字体替代的，则保证替代字体是存在的</h3>

<table>
<thead>
<tr>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>HKEY_CURRENT_USER</td>
  <td>Software\Wine\Fonts\Replacements</td>
  <td>字体替换</td>
</tr>
</tbody></table>


<p><img src="http://img.blog.csdn.net/20161219093400621?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p>

<h3 id="第四步-检查substitute注册表是否存在需要保证右侧的替代字体存在且逗号右边的charset和左侧的被替代字体一致">第四步、 检查Substitute注册表是否存在，需要保证右侧的替代字体存在，且逗号右边的charset和左侧的被替代字体一致</h3>

<table>
<thead>
<tr>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows NT\CurrentVersion\FontSubstitutes</td>
  <td>字体替代</td>
</tr>
</tbody></table>


<p><img src="http://img.blog.csdn.net/20161219093740924?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p>



<h3 id="第五步检查font-link存在这种字体保证右侧的文件名和字体名称在字体注册表里都存在比如tahoma右侧的simsunttf-是替换字体的文件名simsun是字体名需要保证simsun跟simsunttf在第二步注册表里存在才是有效的如果simsun是替代的字体只要它的替代字体和这个文件名一致也可以">第五步、检查Font Link存在这种字体，保证右侧的文件名和字体名称在字体注册表里都存在。比如Tahoma右侧的SimSun.ttf 是替换字体的文件名，SimSun是字体名，需要保证SimSun跟SimSun.ttf在第二步注册表里存在才是有效的。如果SimSun是替代的字体，只要它的替代字体和这个文件名一致也可以。</h3>

<table>
<thead>
<tr>
  <th>主键</th>
  <th>子建</th>
  <th>说明</th>
</tr>
</thead>
<tbody><tr>
  <td>HKEY_LOCAL_MACHINE</td>
  <td>Software\Microsoft\Windows NT\CurrentVersion\FontLink</td>
  <td>字体链接</td>
</tr>
</tbody></table>


<p><img src="http://img.blog.csdn.net/20161219094050297?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXl4dWFuNDc1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p>



<h3 id="如果以上过程都不存在就需要手动添加字体或添加替代字体">如果以上过程都不存在，就需要手动添加字体或添加替代字体。</h3>



<h3 id="如果存在但是还是没有正常显示就需要进一步检查是否存在多个替代且替代的字体本身就不支持中文">如果存在，但是还是没有正常显示，就需要进一步检查是否存在多个替代且替代的字体本身就不支持中文</h3></div></body>
</html>